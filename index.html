<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Polyex</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root {
  --violet: #6b42c1;
  --violet-dark: #4a2a8c;
  --turquoise: #33c4c4;
  --turquoise-light: #5cdcdc;
  --bg: #1e1e2e;
  --text: #e0e0e0;
  --panel: #2a2a40;
  --border: #444;
}

body {
  margin:0;
  font-family:Arial,sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  background: var(--violet);
  color: var(--text);
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  position: sticky;
  top:0;
  z-index: 10;
}

nav {
  background: var(--violet-dark);
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px;
  position: sticky;
  top: 55px;
  z-index:9;
}

nav button {
  background: var(--turquoise);
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: bold;
  color: var(--bg);
  cursor: pointer;
}

nav button:hover {
  background: var(--turquoise-light);
}

.section { display:none; padding: 15px; }

.panel {
  background: var(--panel);
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
}

input, textarea {
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid var(--border);
  background: #1f1f35;
  color: var(--text);
}

textarea { resize: vertical; height: 120px; }

button.btn {
  background: var(--turquoise);
  color: var(--bg);
  border:none;
  padding:10px 16px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  margin-top:5px;
}

button.btn:hover {
  background: var(--turquoise-light);
}

button.ghost {
  background: var(--violet-dark);
  color: var(--text);
}

.post {
  background: #2b2b45;
  padding: 10px;
  border-radius:8px;
  margin-bottom:10px;
  border-left: 4px solid var(--turquoise);
}

.post img {
  max-width:100%;
  max-height:250px;
  border-radius:6px;
  margin-top:6px;
}

.meta {
  font-size:12px;
  color:#ccc;
  margin-bottom:5px;
}
.message {padding:8px;border-radius:6px;margin-top:6px;font-weight:bold;}
.success {background:#2ecc71;}
.error {background:#e74c3c;}
</style>
</head>
<body>

<header>POLYEX <span id="userRole"></span></header>

<nav>
  <button onclick="showSection('forum')">Forums</button>
  <button onclick="showSection('note')">Bloc-notes</button>
  <button onclick="showSection('rdv')">Rendez-vous</button>
  <button onclick="showSection('params')">Paramètres</button>
  <button onclick="showSection('account')">Compte</button>
</nav>

<!-- FORUM -->
<div id="forum" class="section">
  <h2>Forums</h2>
  <div>
    <input id="forumCode" placeholder="Code du forum">
    <button class="btn" onclick="joinForum()">Entrer</button>
  </div>
  <div id="joinedForums" style="margin-top:10px;"></div>
  <div id="forumArea" style="display:none;margin-top:10px;">
    <h3 id="forumTitle"></h3>
    <textarea id="postText" placeholder="Écris ton message"></textarea>
    <input type="file" id="postImage" accept="image/*">
    <button class="btn" onclick="addPost()">Poster</button>
    <h4>Messages</h4>
    <div id="postsList"></div>
    <button class="ghost" onclick="closeForum()">Fermer le forum</button>
  </div>
</div>

<!-- BLOC-NOTES -->
<div id="note" class="section">
  <h2>Bloc-notes</h2>
  <textarea id="notepad" placeholder="Écris ici..."></textarea>
  <button class="btn" onclick="saveNote()">Sauvegarder</button>
</div>

<!-- RENDEZ-VOUS -->
<div id="rdv" class="section">
  <h2>Rendez-vous</h2>
  <input id="rdvTitle" placeholder="Titre">
  <input id="rdvDate" type="date">
  <input id="rdvTime" type="time">
  <button class="btn" onclick="addRdv()">Ajouter</button>
  <div id="rdvList" style="margin-top:10px;"></div>
</div>

<!-- PARAMÈTRES -->
<div id="params" class="section">
  <h2>Paramètres</h2>
  <p>Connecté en : <b id="currentUserDisplay">Aucun</b></p>

  <!-- SECTION ADMIN -->
  <div id="adminForumSection" style="display:none; margin-top:15px; padding:10px; background:#1f1f35; border-radius:8px;">
    <h3>Créer un forum (Admin)</h3>
    <input id="newForumCode" placeholder="Code du forum (ex: SPORT01)">
    <input id="newForumName" placeholder="Nom du forum">
    <button class="btn" onclick="createForum()">Créer</button>
    <p id="adminMsg"></p>
    <h3>Forums existants</h3>
    <div id="adminForumList"></div>
  </div>

  <button class="ghost" style="margin-top:15px;" onclick="logout()">Déconnexion</button>
</div>

<!-- COMPTE -->
<div id="account" class="section">
  <h2>Connexion</h2>
  <input id="loginUser" placeholder="Nom d'utilisateur">
  <input id="loginPass" type="password" placeholder="Mot de passe">
  <button class="btn" onclick="login()">Se connecter</button>
  <div id="accountMsg"></div>
</div>

<script>
/* ---------------- STOCKAGE ---------------- */
let accounts = JSON.parse(localStorage.getItem("accounts")||"{}");
let currentUser = localStorage.getItem("currentUser") || null;
let validCodes = JSON.parse(localStorage.getItem("validCodes")||'{"SPORT01":"Sport","MUSIC01":"Musique"}');
let forums = JSON.parse(localStorage.getItem("forums")||"{}");
let joinedForums = [];
let currentForum = null;

/* Création automatique compte admin */
const adminUsername="Admin";
const adminPassword="Admin345";
if(!accounts[adminUsername]){
  accounts[adminUsername] = adminPassword;
  localStorage.setItem("accounts",JSON.stringify(accounts));
}

/* ---------------- NAVIGATION ---------------- */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* ---------------- LOGIN ---------------- */
function login(){
  const user = document.getElementById("loginUser").value.trim();
  const pass = document.getElementById("loginPass").value.trim();
  if(!accounts[user] || accounts[user]!==pass){
    document.getElementById("accountMsg").innerHTML="<div class='message error'>Identifiants incorrects</div>";
    return;
  }
  currentUser=user;
  localStorage.setItem("currentUser",user);
  document.getElementById("currentUserDisplay").innerText=currentUser;
  document.getElementById("userRole").innerText=user===adminUsername ? " (Admin)" : "";
  initUser();
  showSection('forum');
}

/* ---------------- INIT USER ---------------- */
function initUser(){
  joinedForums = JSON.parse(localStorage.getItem("joinedForums_"+currentUser)||"[]");
  renderJoinedForums();
  renderAdminForumList();
  document.getElementById("adminForumSection").style.display = currentUser===adminUsername?"block":"none";

  const last = localStorage.getItem("lastForum_"+currentUser);
  if(last) openForum(last);

  document.getElementById("notepad").value = localStorage.getItem("note_"+currentUser)||"";
}

/* ---------------- BLOC-NOTES ---------------- */
function saveNote(){
  localStorage.setItem("note_"+currentUser,document.getElementById("notepad").value);
  alert("Bloc-notes sauvegardé !");
}

/* ---------------- RENDEZ-VOUS ---------------- */
function addRdv(){
  const title=document.getElementById("rdvTitle").value.trim();
  const date=document.getElementById("rdvDate").value;
  const time=document.getElementById("rdvTime").value;
  if(!title || !date || !time) return alert("Remplis tous les champs");
  const div=document.createElement("div");
  div.textContent=`${title} — ${date} ${time}`;
  document.getElementById("rdvList").appendChild(div);
}

/* ---------------- FORUM ---------------- */
function joinForum(){
  const code = document.getElementById("forumCode").value.trim();
  if(!validCodes[code]) return alert("Code invalide");
  if(!joinedForums.includes(code)) joinedForums.push(code);
  localStorage.setItem("joinedForums_"+currentUser,JSON.stringify(joinedForums));
  renderJoinedForums();
  openForum(code);
  document.getElementById("forumCode").value="";
}

function renderJoinedForums(){
  const box=document.getElementById("joinedForums");
  box.innerHTML="";
  joinedForums.forEach(c=>{
    const b=document.createElement("button");
    b.className="btn";
    b.textContent=validCodes[c];
    b.onclick=()=>openForum(c);
    box.appendChild(b);
  });
}

function openForum(code){
  currentForum=code;
  localStorage.setItem("lastForum_"+currentUser,code);
  document.getElementById("forumTitle").textContent=validCodes[code];
  document.getElementById("forumArea").style.display="block";
  renderPosts();
}

function closeForum(){
  currentForum=null;
  document.getElementById("forumArea").style.display="none";
}

function addPost(){
  if(!currentForum) return;
  const text=document.getElementById("postText").value.trim();
  const file=document.getElementById("postImage").files[0];
  if(!text && !file) return alert("Message vide");
  if(!forums[currentForum]) forums[currentForum]=[];
  if(file){
    const reader=new FileReader();
    reader.onload=e=>{
      forums[currentForum].push({user:currentUser,text,image:e.target.result,date:new Date().toLocaleString()});
      localStorage.setItem("forums",JSON.stringify(forums));
      renderPosts();
    };
    reader.readAsDataURL(file);
  } else {
    forums[currentForum].push({user:currentUser,text,image:null,date:new Date().toLocaleString()});
    localStorage.setItem("forums",JSON.stringify(forums));
    renderPosts();
  }
  document.getElementById("postText").value="";
  document.getElementById("postImage").value="";
}

function renderPosts(){
  const box=document.getElementById("postsList");
  box.innerHTML="";
  if(!forums[currentForum]) return;
  forums[currentForum].forEach(p=>{
    const div=document.createElement("div");
    div.className="post";
    const meta=document.createElement("div");
    meta.className="meta";
    meta.textContent=p.user+" — "+p.date;
    div.appendChild(meta);
    if(p.text){ const t=document.createElement("p"); t.textContent=p.text; div.appendChild(t);}
    if(p.image){ const img=document.createElement("img"); img.src=p.image; div.appendChild(img);}
    box.appendChild(div);
  });
}

/* ---------------- ADMIN ---------------- */
function createForum(){
  const code=document.getElementById("newForumCode").value.trim();
  const name=document.getElementById("newForumName").value.trim();
  if(!code || !name){document.getElementById("adminMsg").innerText="Remplis tous les champs"; return;}
  validCodes[code]=name;
  localStorage.setItem("validCodes",JSON.stringify(validCodes));
  document.getElementById("adminMsg").innerText="Forum créé !";
  document.getElementById("newForumCode").value="";
  document.getElementById("newForumName").value="";
  renderAdminForumList();
}

function renderAdminForumList(){
  const box=document.getElementById("adminForumList");
  box.innerHTML="";
  for(const c in validCodes){
    const div=document.createElement("div");
    div.textContent=c+" : "+validCodes[c];
    box.appendChild(div);
  }
}

/* ---------------- LOGOUT ---------------- */
function logout(){
  currentUser=null;
  localStorage.removeItem("currentUser");
  location.reload();
}

/* ---------------- INIT ---------------- */
if(currentUser){
  document.getElementById("currentUserDisplay").innerText=currentUser;
  document.getElementById("userRole").innerText=currentUser===adminUsername?" (Admin)":"";
  initUser();
  showSection('forum');
}else showSection('account');
</script>

</body>
</html>