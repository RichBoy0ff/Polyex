<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Polyex</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* === COULEURS === */
:root {
  --violet: #6b42c1;
  --violet-dark: #4a2a8c;
  --turquoise: #33c4c4;
  --turquoise-light: #5cdcdc;
  --bg: #1e1e2e;
  --text: #e0e0e0;
  --panel: #2a2a40;
  --border: #444;
}

/* === GLOBAL === */
body {
  margin:0;
  font-family:Arial,sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* === HEADER === */
header{
  background: var(--violet);
  color: var(--text);
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:10;
}

header h1{
  flex-grow:1;
  text-align:center;
  margin:0;
  font-size:20px;
}

/* BURGER */
.burger{
  width:30px;
  height:20px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  cursor:pointer;
}
.burger div{
  height:4px;
  background:white;
  border-radius:2px;
}

/* PSEUDO CONNECTÉ */
#userRole{
  margin-left:10px;
  font-weight:bold;
  color: var(--turquoise-light);
}

/* PARAM BTN */
#paramBtn{
  display:none;
  background:var(--turquoise);
  padding:6px 12px;
  border:none;
  border-radius:6px;
  color:var(--bg);
  cursor:pointer;
}
#paramBtn:hover{ background: var(--turquoise-light); }

/* MENU LATERAL */
#sideMenu{
  position:fixed;
  top:0;
  left:-260px;
  width:240px;
  height:100%;
  background:var(--violet-dark);
  padding-top:70px;
  transition:0.25s;
  z-index:20;
}
#sideMenu button{
  width:85%;
  margin:10px auto;
  padding:12px;
  border:none;
  border-radius:6px;
  background:rgba(255,255,255,0.1);
  color:white;
  cursor:pointer;
}
#sideMenu button:hover{
  background:rgba(255,255,255,0.2);
}

/* PANELS */
main{ padding:14px; }
.panel{
  background: var(--panel);
  border-radius:10px;
  padding:15px;
  margin-bottom:15px;
}
.section{ display:none; }
.active{ display:block; }

/* INPUTS */
input, textarea{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid var(--border);
  background:#1f1f35;
  color: var(--text);
}
textarea{ height:130px; resize:vertical; }

/* BUTTONS */
button.btn{
  background:var(--turquoise);
  color:var(--bg);
  border:none;
  padding:10px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  margin-top:5px;
}
button.btn:hover{ background: var(--turquoise-light); }
button.ghost{
  background:var(--violet-dark);
  color: var(--text);
}

/* POSTS FORUM */
.post{
  background: #2b2b45;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  border-left:4px solid var(--turquoise);
}
.post img{
  max-width:100%;
  max-height:250px;
  border-radius:6px;
  margin-top:6px;
}
.meta{
  font-size:12px;
  color:#ccc;
  margin-bottom:5px;
}
.message{padding:8px;border-radius:6px;margin-top:6px;font-weight:bold;}
.success{background:#2ecc71;}
.error{background:#e74c3c;}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;">
    <div class="burger" onclick="toggleMenu()"><div></div><div></div><div></div></div>
    <span id="userRole"></span>
  </div>
  <h1>Polyex Outils</h1>
  <button id="paramBtn" onclick="showSection('params')">Paramètres</button>
</header>

<div id="sideMenu">
  <button onclick="showSection('auth'); toggleMenu()">Compte / Connexion</button>
  <button onclick="showSection('note'); toggleMenu()">Bloc-notes</button>
  <button onclick="showSection('rdv'); toggleMenu()">Rendez-vous</button>
  <button onclick="showSection('forum'); toggleMenu()">Forum</button>
  <button onclick="showSection('params'); toggleMenu()">Paramètres</button>
</div>

<main>
<!-- AUTH -->
<div id="auth" class="section panel">
  <h2>Connexion / Inscription</h2>
  <input id="authUser" placeholder="Nom d'utilisateur">
  <input id="authPass" type="password" placeholder="Mot de passe">
  <input id="authPass2" type="password" placeholder="Répéter mot de passe">
  <button class="btn" onclick="register()">S'inscrire</button>
  <button class="btn" onclick="login()">Se connecter</button>
  <p id="authMsg" class="message"></p>
</div>

<!-- NOTE -->
<div id="note" class="section panel">
  <h2>Bloc-notes</h2>
  <textarea id="notepad"></textarea>
  <button class="btn" onclick="saveNote()">Sauvegarder</button>
</div>

<!-- RDV -->
<div id="rdv" class="section panel">
  <h2>Rendez-vous</h2>
  <input id="rdvTitle" placeholder="Titre">
  <input id="rdvDate" type="date">
  <input id="rdvTime" type="time">
  <button class="btn" onclick="addRdv()">Ajouter</button>
  <div id="rdvList"></div>
</div>

<!-- FORUM -->
<div id="forum" class="section panel">
  <h2>Forum</h2>
  <input id="forumCode" placeholder="Code d'accès">
  <button class="btn" onclick="joinForum()">Entrer</button>
  <div id="joinedForums"></div>
  <div id="forumArea" style="display:none;margin-top:15px">
    <h3 id="forumTitle"></h3>
    <textarea id="postText" placeholder="Écris ton message..."></textarea>
    <input type="file" id="postImage" accept="image/*">
    <button class="btn" onclick="addPost()">Poster</button>
    <h4>Messages</h4>
    <div id="postsList"></div>
    <button class="ghost" onclick="closeForum()">Fermer</button>
  </div>
</div>

<!-- PARAMS -->
<div id="params" class="section panel">
  <h2>Paramètres</h2>
  <p>Changer de pseudo :</p>
  <input id="newUser">
  <button class="btn" onclick="changeUsername()">Valider</button>
  <p>Changer de mot de passe :</p>
  <input id="oldPass" type="password" placeholder="Ancien">
  <input id="newPass" type="password" placeholder="Nouveau">
  <input id="newPass2" type="password" placeholder="Confirmer">
  <button class="btn" onclick="changePassword()">Valider</button>

  <!-- ADMIN -->
  <div id="adminForumSection" style="margin-top:15px;border-top:1px solid var(--border);padding-top:10px;display:none;">
    <h3>Créer un forum (Admin)</h3>
    <input id="newForumCode" placeholder="Code forum">
    <input id="newForumName" placeholder="Nom forum">
    <button class="btn" onclick="createForum()">Créer</button>
    <div id="adminForumList"></div>
  </div>

  <button class="ghost" onclick="logout()">Déconnexion</button>
</div>

</main>

<script>
// === MENU ===
function toggleMenu(){
  const menu=document.getElementById("sideMenu");
  menu.style.left = menu.style.left==="0px" ? "-260px" : "0px";
}
function showSection(id){
  document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// === AUTH ===
let accounts=JSON.parse(localStorage.getItem("accounts")||"{}");
let currentUser=localStorage.getItem("currentUser")||null;
const adminUsername="Admin";
const adminPassword="Admin345";
if(!accounts[adminUsername]){accounts[adminUsername]=adminPassword; localStorage.setItem("accounts", JSON.stringify(accounts));}

function register(){
  const u=document.getElementById("authUser").value.trim();
  const p=document.getElementById("authPass").value;
  const p2=document.getElementById("authPass2").value;
  if(!u||!p){alert("Champs manquants");return;}
  if(p!==p2){alert("Les mots de passe ne correspondent pas");return;}
  if(accounts[u]){alert("Utilisateur déjà existant");return;}
  accounts[u]=p; localStorage.setItem("accounts", JSON.stringify(accounts));
  alert("Compte créé !");
}
function login(){
  const u=document.getElementById("authUser").value.trim();
  const p=document.getElementById("authPass").value;
  if(accounts[u] && accounts[u]===p){
    currentUser=u; localStorage.setItem("currentUser", u);
    document.getElementById("userRole").textContent=u;
    document.getElementById("paramBtn").style.display="inline-block";
    initUser();
    showSection("note");
  } else alert("Login incorrect");
}
function logout(){
  currentUser=null; localStorage.removeItem("currentUser"); showSection("auth"); location.reload();
}

// === INIT USER DATA ===
let forums=JSON.parse(localStorage.getItem("forums")||"{}");
let validCodes=JSON.parse(localStorage.getItem("validCodes")||'{"SPORT01":"Sport","MUSIC01":"Musique"}');
let joinedForums=[],currentForum=null;

function initUser(){
  joinedForums=JSON.parse(localStorage.getItem("joinedForums_"+currentUser)||"[]");
  renderJoinedForums();
  document.getElementById("notepad").value=localStorage.getItem("note_"+currentUser)||"";
  document.getElementById("userRole").textContent=currentUser;
  checkAdminAccess();

  const last=localStorage.getItem("lastForum_"+currentUser);
  if(last) openForum(last);
}

// === BLOC-NOTES ===
function saveNote(){ localStorage.setItem("note_"+currentUser, document.getElementById("notepad").value); alert("Sauvegardé !"); }

// === RDV ===
function addRdv(){
  const div=document.createElement("div");
  div.textContent=document.getElementById("rdvTitle").value+" — "+document.getElementById("rdvDate").value+" "+document.getElementById("rdvTime").value;
  document.getElementById("rdvList").appendChild(div);
}

// === FORUM ===
function joinForum(){
  const code=document.getElementById("forumCode").value.trim();
  if(!validCodes[code]){alert("Code invalide");return;}
  if(!joinedForums.includes(code)){joinedForums.push(code); localStorage.setItem("joinedForums_"+currentUser, JSON.stringify(joinedForums));}
  renderJoinedForums(); openForum(code); document.getElementById("forumCode").value="";
}
function renderJoinedForums(){
  const box=document.getElementById("joinedForums"); box.innerHTML="";
  joinedForums.forEach(code=>{
    const b=document.createElement("button");
    b.className="btn"; b.textContent=validCodes[code]; b.onclick=()=>openForum(code);
    box.appendChild(b);
  });
}
function openForum(code){
  currentForum=code; localStorage.setItem("lastForum_"+currentUser, code);
  document.getElementById("forumArea").style.display="block";
  document.getElementById("forumTitle").textContent=validCodes[code];
  renderPosts();
}
function closeForum(){ currentForum=null; document.getElementById("forumArea").style.display="none"; }
function addPost(){
  if(!currentForum) return; const text=document.getElementById("postText").value.trim();
  const file=document.getElementById("postImage").files[0];
  if(!text && !file){alert("Message vide"); return;}
  if(file){ const reader=new FileReader(); reader.onload=e=>savePost(text,e.target.result); reader.readAsDataURL(file);}
  else savePost(text,null);
  document.getElementById("postText").value=""; document.getElementById("postImage").value="";
}
function savePost(text,image){
  if(!forums[currentForum]) forums[currentForum]=[];
  forums[currentForum].push({user:currentUser,text,image,date:new Date().toLocaleString()});
  localStorage.setItem("forums", JSON.stringify(forums));
  renderPosts();
}
function renderPosts(){
  const box=document.getElementById("postsList"); box.innerHTML="";
  if(!forums[currentForum]) return;
  forums[currentForum].forEach(p=>{
    const div=document.createElement("div"); div.className="post";
    const meta=document.createElement("div"); meta.className="meta"; meta.textContent=p.user+" — "+p.date; div.appendChild(meta);
    if(p.text){ const t=document.createElement("p"); t.textContent=p.text; div.appendChild(t);}
    if(p.image){ const img=document.createElement("img"); img.src=p.image; div.appendChild(img);}
    box.appendChild(div);
  });
}

// === PARAMS / ADMIN ===
function changeUsername(){
  const newUser=document.getElementById("newUser").value.trim();
  if(!newUser){alert("Nom vide"); return;}
  accounts[newUser]=accounts[currentUser]; delete accounts[currentUser]; currentUser=newUser;
  localStorage.setItem("accounts", JSON.stringify(accounts)); localStorage.setItem("currentUser", newUser);
  document.getElementById("userRole").textContent=currentUser; alert("Pseudo changé !");
}

function changePassword(){
  const oldP=document.getElementById("oldPass").value;
  const newP=document.getElementById("newPass").value;
  const newP2=document.getElementById("newPass2").value;
  if(oldP!==accounts[currentUser]){alert("Ancien mot de passe incorrect"); return;}
  if(newP!==newP2){alert("Les mots de passe ne correspondent pas"); return;}
  accounts[currentUser]=newP; localStorage.setItem("accounts", JSON.stringify(accounts)); alert("Mot de passe changé !");
}

// ADMIN FORUM
function checkAdminAccess(){
  document.getElementById("adminForumSection").style.display=currentUser===adminUsername?"block":"none";
}
function createForum(){
  const code=document.getElementById("newForumCode").value.trim();
  const name=document.getElementById("newForumName").value.trim();
  if(!code||!name){alert("Remplir tous les champs"); return;}
  validCodes[code]=name; localStorage.setItem("validCodes", JSON.stringify(validCodes)); alert("Forum créé !");
  renderAdminForumList();
}
function renderAdminForumList(){
  const list=document.getElementById("adminForumList"); list.innerHTML="";
  for(const c in validCodes){ const div=document.createElement("div"); div.textContent=c+" : "+validCodes[c]; list.appendChild(div);}
}

// === INIT ===
if(currentUser){ document.getElementById("paramBtn").style.display="inline-block"; initUser(); showSection("note"); } 
else showSection("auth");
</script>

</body>
</html>