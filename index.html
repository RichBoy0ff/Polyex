<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Polyex</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:0;color:#222}
header{background:#333;color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.burger{width:30px;cursor:pointer;display:flex;flex-direction:column;justify-content:space-between;height:20px}
.burger div{height:4px;background:#fff;border-radius:2px}
#sideMenu{position:fixed;top:0;left:-260px;width:260px;height:100%;background:#222;color:#fff;padding-top:64px;transition:0.25s;z-index:20}
#sideMenu button{width:86%;margin:8px auto;display:block;padding:10px;background:#444;border:none;color:#fff;border-radius:6px;cursor:pointer}
#sideMenu button:hover{background:#555}
main{padding:24px;margin-left:0;transition:0.25s}
.section{display:none}
.active{display:block}
.panel{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.08);max-width:800px;margin:12px auto;text-align:left}
textarea{width:100%;height:120px;padding:8px;font-size:14px;border-radius:6px;border:1px solid #ddd;resize:vertical}
input{padding:6px;margin:6px 0;border-radius:6px;border:1px solid #ccc;width:100%}
button.btn{padding:6px 10px;background:#28a745;color:#fff;border:none;border-radius:6px;cursor:pointer}
button.ghost{background:#eee;color:#333}
.post{border-radius:6px;padding:8px;background:#fff;margin-bottom:8px;border:1px solid #eee}
.post img{max-width:200px;border-radius:6px;max-height:220px;object-fit:contain}
.meta{font-size:12px;color:#666;margin-bottom:4px}
.right{float:right}
.forumList button{margin:4px 2px;}
</style>
</head>
<body>

<header>
  <div>Polyex Outils</div>
  <div class="burger" onclick="toggleMenu()"><div></div><div></div><div></div></div>
</header>

<div id="sideMenu">
  <button onclick="showSection('auth'); toggleMenu()">Compte / Connexion</button>
  <button onclick="showSection('note'); toggleMenu()">Bloc-notes</button>
  <button onclick="showSection('rdv'); toggleMenu()">Rendez-vous</button>
  <button onclick="showSection('forum'); toggleMenu()">Forum</button>
  <button onclick="showSection('help'); toggleMenu()">Aide</button>
</div>

<main>

<!-- Auth -->
<div id="auth" class="section panel">
  <h2>Connexion / Inscription</h2>
  <input id="authUser" placeholder="Nom d'utilisateur">
  <input id="authPass" type="password" placeholder="Mot de passe">
  <input id="authPass2" type="password" placeholder="Répéter mot de passe (inscription)">
  <button class="btn" onclick="register()">S'inscrire</button>
  <button class="btn" onclick="login()">Se connecter</button>
  <p id="authMsg" style="color:red;"></p>
</div>

<!-- Bloc-notes -->
<div id="note" class="section panel">
  <h2>Bloc-notes</h2>
  <textarea id="notepad" placeholder="Écris ton texte ici..."></textarea>
  <div style="margin-top:8px">
    <button class="btn" onclick="saveNote()">Sauvegarder</button>
    <button class="btn ghost" onclick="downloadNote()">Télécharger</button>
    <button class="btn ghost" onclick="openNote()">Ouvrir un fichier</button>
    <input type="file" id="fileInput" accept=".txt" style="display:none">
  </div>
</div>

<!-- Rendez-vous -->
<div id="rdv" class="section panel">
  <h2>Rendez-vous</h2>
  <input id="rdvName" placeholder="Titre">
  <input id="rdvDate" type="date">
  <input id="rdvTime" type="time">
  <button class="btn" onclick="addRdv()">Ajouter</button>
  <div id="rdvList" style="margin-top:12px"></div>
</div>

<!-- Forum -->
<div id="forum" class="section panel">
  <h2>Forum</h2>

  <div id="forumAccess">
    <p>Rejoins un forum : entre le code d'accès</p>
    <input id="forumCode" placeholder="Code d'accès">
    <button class="btn" onclick="joinForum()">Valider</button>
  </div>

  <div id="joinedForums" class="forumList" style="margin-top:10px"></div>

  <div id="forumArea" style="display:none;margin-top:12px">
    <h3 id="forumTitle"></h3>
    <textarea id="postText" placeholder="Écris ton message..."></textarea>
    <input type="file" id="postImage" accept="image/*" style="margin-top:6px">
    <div style="margin-top:6px">
      <button class="btn" onclick="addPost()">Poster</button>
    </div>
    <h4>Messages</h4>
    <div id="postsList"></div>
    <button class="btn ghost" onclick="closeForum()">Fermer ce forum</button>
  </div>
</div>

<!-- Aide -->
<div id="help" class="section panel">
  <h2>Aide</h2>
  <ul>
    <li>Les forums et messages sont sauvegardés automatiquement.</li>
    <li>Chaque code ouvre un forum différent.</li>
    <li>Images stockées en base64.</li>
    <li>Compatible Android / iPhone / PC.</li>
    <li>Le pseudo utilisé pour poster est votre nom d'utilisateur connecté.</li>
  </ul>
</div>

<script>
// --- Menu ---
function toggleMenu(){
  const menu=document.getElementById("sideMenu");
  menu.style.left = menu.style.left==="0px" ? "-260px" : "0px";
}
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// --- Auth ---
let accounts = JSON.parse(localStorage.getItem("accounts")||"{}");
let currentUser = localStorage.getItem("currentUser") || null;

function register(){
  const u=document.getElementById("authUser").value.trim();
  const p=document.getElementById("authPass").value;
  const p2=document.getElementById("authPass2").value;
  if(!u||!p){alert("Remplis tous les champs"); return;}
  if(p!==p2){alert("Les mots de passe ne correspondent pas"); return;}
  if(accounts[u]){alert("Utilisateur déjà existant"); return;}
  accounts[u]=p;
  localStorage.setItem("accounts", JSON.stringify(accounts));
  alert("Inscription réussie !");
}
function login(){
  const u=document.getElementById("authUser").value.trim();
  const p=document.getElementById("authPass").value;
  if(accounts[u] && accounts[u]===p){
    currentUser=u;
    localStorage.setItem("currentUser", currentUser);
    alert("Connexion réussie !");
    initUserData();
    showSection('note');
  } else alert("Nom d'utilisateur ou mot de passe incorrect");
}

// --- Bloc-notes ---
function initUserData(){
  document.getElementById("notepad").value = localStorage.getItem("note_"+currentUser)||"";
  rdvList = JSON.parse(localStorage.getItem("rdv_"+currentUser)||"[]");
  joinedForums = JSON.parse(localStorage.getItem("joinedForums_"+currentUser)||"[]");
  displayRdv();
  renderJoinedForums();
}

function saveNote(){
  if(!currentUser){alert("Connecte-toi pour sauvegarder"); return;}
  const t=document.getElementById("notepad").value;
  localStorage.setItem("note_"+currentUser, t);
  alert("Note sauvegardée ✔️");
}

function downloadNote(){
  if(!currentUser){alert("Connecte-toi pour télécharger"); return;}
  const t=document.getElementById("notepad").value;
  const blob=new Blob([t],{type:"text/plain"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="note_"+currentUser+".txt";
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

function openNote(){document.getElementById("fileInput").click();}
document.getElementById("fileInput").addEventListener("change",function(){
  const f=this.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=function(e){
    document.getElementById("notepad").value=e.target.result;
    if(currentUser) localStorage.setItem("note_"+currentUser,e.target.result);
  };
  r.readAsText(f);
});

// --- Rendez-vous ---
let rdvList=[];
function addRdv(){
  if(!currentUser){alert("Connecte-toi !"); return;}
  const n=document.getElementById("rdvName").value;
  const d=document.getElementById("rdvDate").value;
  const t=document.getElementById("rdvTime").value;
  if(!n||!d||!t){alert("Remplis tout !");return;}
  rdvList.push({name:n,date:d,time:t});
  localStorage.setItem("rdv_"+currentUser, JSON.stringify(rdvList));
  displayRdv();
}
function displayRdv(){
  const c=document.getElementById("rdvList");
  c.innerHTML="";
  rdvList.forEach((r,i)=>{
    c.innerHTML+=`<div class="post"><div><strong>${r.name}</strong><br>${r.date} à ${r.time}</div></div>`;
  });
}

// --- Forum ---
const validCodes = {"HkjO89":"Forum Internet Beats","KPoli8h":"Forum Steal a Brainrot [Vitox]","SPORTS02":"Forum Sports","ETUDES03":"Forum Études"};
let forums = JSON.parse(localStorage.getItem("forums")||"{}");
let joinedForums = [];
let currentForum=null;

function joinForum(){
  if(!currentUser){alert("Connecte-toi pour rejoindre"); return;}
  const code=document.getElementById("forumCode").value.trim();
  if(!validCodes[code]){alert("Code invalide !"); return;}
  if(!joinedForums.includes(code)) joinedForums.push(code);
  localStorage.setItem("joinedForums_"+currentUser,JSON.stringify(joinedForums));
  document.getElementById("forumCode").value="";
  renderJoinedForums();
}

function renderJoinedForums(){
  const container=document.getElementById("joinedForums");
  container.innerHTML="<h4>Forums rejoints :</h4>";
  joinedForums.forEach(code=>{
    const btn=document.createElement("button");
    btn.textContent=validCodes[code];
    btn.onclick=()=>openForum(code);
    container.appendChild(btn);
  });
}

function openForum(code){
  currentForum=code;
  document.getElementById("forumArea").style.display="block";
  document.getElementById("forumTitle").textContent=validCodes[code];
  renderPosts();
}

function closeForum(){currentForum=null; document.getElementById("forumArea").style.display="none";}

function renderPosts(){
  if(!currentForum) return;
  const posts=forums[currentForum]||[];
  const container=document.getElementById("postsList");
  container.innerHTML="";
  posts.forEach(p=>{
    let imgHTML=p.img?`<img src="${p.img}">`:"";
    container.innerHTML+=`<div class="post"><div class="meta"><strong>${p.user}</strong> - ${p.date}</div>${p.text}<br>${imgHTML}</div>`;
  });
}

function addPost(){
  if(!currentForum) return;
  const text=document.getElementById("postText").value.trim();
  if(!text){alert("Écris quelque chose !"); return;}
  const file=document.getElementById("postImage").files[0];
  const reader=new FileReader();
  reader.onload=function(e){
    if(!forums[currentForum]) forums[currentForum]=[];
    forums[currentForum].push({user:currentUser,text:text,img:e.target.result,date:new Date().toLocaleString()});
    localStorage.setItem("forums",JSON.stringify(forums));
    document.getElementById("postText").value="";
    document.getElementById("postImage").value="";
    renderPosts();
  };
  if(file) reader.readAsDataURL(file); else reader.onload({target:{result:null}});
}

// --- Initialisation ---
if(currentUser) initUserData();
showSection(currentUser?'note':'auth');
</script>

</body>
</html>
